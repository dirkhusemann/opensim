<?xml version="1.0"?>
    <project name="OpenSim" default="build" basedir=".">
        <description>nant buildfile for OpenSim</description>
        <property name="debug" value="true" overwrite="false" />
        <target name="clean" description="remove all generated files">
            <delete file="bin/OpenSim.exe" failonerror="false" />
	    <delete file="bin/OpenSim.pdb" failonerror="false" />
        </target>

	<target name="svnupdate" description="updates to latest SVN">
		<exec program="svn">
			<arg value="update" />
		</exec>
	</target>

	<target name="upgrade" description="updates from SVN and then builds" depends="clean,svnupdate,build">
		
	</target>

	<target name="genvers">
		<exec program="genvers.sh" />	
		<loadfile file="VERSION" property="svnver"/>
	</target>
	
	<target name="setvers">
		<property name="svnver" value="0.0.0.1" />
	</target>
	
	<target name="build" description="compiles the source code" depends="genvers, core_build">
	</target>
		
	<target name="nogenvers" description="compiles the source code" depends="setvers, core_build">
	</target>
	
	<target name="core_build" description="compiles the source code">

	<asminfo output="src/AssemblyInfo.cs" language="CSharp">
		<imports>
			<import namespace="System" />
			<import namespace="System.Reflection" />
			<import namespace="System.Runtime.InteropServices" />
		</imports>
		<attributes>
			<attribute type="ComVisibleAttribute" value="false" />
			<attribute type="CLSCompliantAttribute" value="false" />
			<attribute type="AssemblyVersionAttribute" value="${svnver}" />
			<attribute type="AssemblyTitleAttribute" value="opensim" />
			<attribute type="AssemblyDescriptionAttribute" value="The C# implementation of the simulator portion of OGS" />
			<attribute type="AssemblyCopyrightAttribute" value="Copyright Â© OGS development team 2007"/>
		</attributes>
	</asminfo>

	<nant>
    		<buildfiles>
        		<include name="src/GridInterfaces/default.build" />
        		<include name="src/OpenGrid.Framework/default.build" />
			<include name="src/ServerConsole/default.build" />
			<include name="src/LocalServers/default.build" />
			<include name="src/RemoteServers/default.build" />
			<include name="src/physics/default.build" />
			<include name="src/physics/plugins/default.build" />
			<include name="src/LocalStorage/default.build" />
			<include name="src/OpenGrid.Framework/default.build" />
		</buildfiles>
	</nant>

	<csc target="exe" output="bin/OpenSim.exe" debug="${debug}" verbose="true" warninglevel="4">
			<references basedir="bin/" failonempty="true">
				<include name="System.dll" />
				<include name="System.Data.dll" />
				<include name="System.Xml.dll" />
				<include name="Axiom.MathLib.dll" />
				<include name="libsecondlife.dll" />
				<include name="log4net.dll" />
				<include name="Db4objects.Db4o.dll" />
				<include name="ServerConsole.dll" />
				<include name="GridInterfaces.dll" />
				<include name="PhysicsManager.dll" />
				<include name="OpenGrid.Framework.dll" />
			</references>
			<sources basedir="src/">
				<include name="*.cs" />
				<include name="types/*.cs" />
				<include name="world/*.cs" />
				<include name="GridServers/*.cs" />
				<include name="Assets/*.cs" />
				<include name="CAPS/*.cs" />
			</sources>
		</csc>

	<nant>
		<buildfiles>
			<include name="src/Config/default.build" />
		</buildfiles>
	</nant>
	</target>
</project>
